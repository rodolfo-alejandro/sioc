{% extends "layouts/base.html" %}

{% block title %}Dashboard - SIOC{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="bi bi-speedometer2"></i> Dashboard</h1>
    <p class="text-muted">Panel de control principal del sistema</p>
</div>

<div class="row g-3">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-database display-6 text-primary"></i>
                <h5 class="mt-3">Datasets</h5>
                <h3 class="text-primary">
                    {% if current_user.has_permission('DATALAB_VIEW') %}
                        <a href="{{ url_for('datalab.datasets') }}" class="text-decoration-none">
                            {{ datasets_count | number_format }}
                        </a>
                    {% else %}
                        -
                    {% endif %}
                </h3>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-people display-6 text-success"></i>
                <h5 class="mt-3">Usuarios</h5>
                <h3 class="text-success">
                    {% if current_user.has_permission('ADMIN_USERS') %}
                        <a href="{{ url_for('admin.users') }}" class="text-decoration-none">
                            {{ users_count | number_format }}
                        </a>
                    {% else %}
                        -
                    {% endif %}
                </h3>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-building display-6 text-info"></i>
                <h5 class="mt-3">Unidad</h5>
                <h6 class="text-info">{{ current_user.unidad.nombre if current_user.unidad else 'N/A' }}</h6>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-person-badge display-6 text-warning"></i>
                <h5 class="mt-3">Rol</h5>
                <h6 class="text-warning">
                    {% if current_user.roles %}
                        {{ current_user.roles[0].name }}
                    {% else %}
                        Sin rol
                    {% endif %}
                </h6>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Bienvenido a SIOC</h5>
            </div>
            <div class="card-body">
                <p>El Sistema Integrado de Registro, Prevención, Investigación y Operaciones Conjuntas (SIOC) 
                es una plataforma integral para la gestión operativa y análisis de datos.</p>
                
                <h6 class="mt-3">Módulos disponibles:</h6>
                <ul>
                    {% if current_user.has_permission('DATALAB_VIEW') %}
                    <li><strong>DataLab:</strong> Suba archivos Excel/CSV y genere estadísticas y gráficos automáticamente.</li>
                    {% endif %}
                    {% if current_user.has_permission('ADMIN_USERS') %}
                    <li><strong>Administración:</strong> Gestione usuarios, roles y permisos del sistema.</li>
                    {% endif %}
                </ul>
                
                <p class="text-muted mt-3">
                    <small>Último acceso: 
                        {% if current_user.last_login_at %}
                            {{ current_user.last_login_at.strftime('%d/%m/%Y %H:%M') }}
                        {% else %}
                            Primera vez
                        {% endif %}
                    </small>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

