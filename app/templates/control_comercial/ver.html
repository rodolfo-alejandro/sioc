{% extends "layouts/base.html" %}

{% block title %}Ver Comercio - SIOC{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="bi bi-shop"></i> {{ comercio.denominacion }}</h1>
    <p class="text-muted">Detalle del comercio</p>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Información General</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Denominación:</dt>
                    <dd class="col-sm-8"><strong>{{ comercio.denominacion }}</strong></dd>
                    
                    <dt class="col-sm-4">Rubro:</dt>
                    <dd class="col-sm-8">{{ comercio.rubro.nombre if comercio.rubro else 'N/A' }}</dd>
                    
                    <dt class="col-sm-4">Domicilio:</dt>
                    <dd class="col-sm-8">{{ comercio.domicilio }}</dd>
                    
                    <dt class="col-sm-4">Barrio:</dt>
                    <dd class="col-sm-8">{{ comercio.barrio.nombre if comercio.barrio else 'N/A' }}</dd>
                    
                    <dt class="col-sm-4">Teléfono:</dt>
                    <dd class="col-sm-8">{{ comercio.telefono or 'N/A' }}</dd>
                    
                    <dt class="col-sm-4">Email:</dt>
                    <dd class="col-sm-8">{{ comercio.email or 'N/A' }}</dd>
                </dl>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">Habilitaciones</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    {% if comercio.habilitacion_municipal %}
                    <dt class="col-sm-4">Municipal:</dt>
                    <dd class="col-sm-8">
                        {{ comercio.habilitacion_municipal_numero or 'N/A' }}
                        {% if comercio.habilitacion_municipal_vencimiento %}
                            - Vence: {{ comercio.habilitacion_municipal_vencimiento.strftime('%d/%m/%Y') }}
                        {% endif %}
                    </dd>
                    {% endif %}
                    
                    {% if comercio.habilitacion_bomberos %}
                    <dt class="col-sm-4">Bomberos:</dt>
                    <dd class="col-sm-8">
                        {{ comercio.habilitacion_bomberos_numero or 'N/A' }}
                        {% if comercio.habilitacion_bomberos_vencimiento %}
                            - Vence: {{ comercio.habilitacion_bomberos_vencimiento.strftime('%d/%m/%Y') }}
                        {% endif %}
                    </dd>
                    {% endif %}
                    
                    {% if comercio.habilitacion_bebidas %}
                    <dt class="col-sm-4">Bebidas Alcohólicas:</dt>
                    <dd class="col-sm-8">
                        {{ comercio.habilitacion_bebidas_numero or 'N/A' }}
                        {% if comercio.habilitacion_bebidas_vencimiento %}
                            - Vence: {{ comercio.habilitacion_bebidas_vencimiento.strftime('%d/%m/%Y') }}
                        {% endif %}
                    </dd>
                    {% endif %}
                </dl>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Controles Realizados</h5>
                {% if current_user.has_permission('CONTROL_COMERCIAL_CREATE') %}
                <a href="{{ url_for('control_comercial.controlar', comercio_id=comercio.id) }}" class="btn btn-sm btn-primary">
                    <i class="bi bi-clipboard-check"></i> Nuevo Control
                </a>
                {% endif %}
            </div>
            <div class="card-body">
                {% if controles %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Usuario</th>
                                <th>Resultado</th>
                                <th>Observaciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for control in controles %}
                            <tr>
                                <td>{{ control.fecha_control.strftime('%d/%m/%Y %H:%M') if control.fecha_control else 'N/A' }}</td>
                                <td>{{ control.usuario.username if control.usuario else 'N/A' }}</td>
                                <td>
                                    {% if control.resultado %}
                                        <span class="badge bg-info">{{ control.resultado }}</span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>{{ control.observaciones_control[:50] if control.observaciones_control else '-' }}...</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay controles registrados.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Ubicación</h5>
            </div>
            <div class="card-body">
                <p><strong>Coordenadas:</strong></p>
                <p>Latitud: {{ comercio.latitud }}</p>
                <p>Longitud: {{ comercio.longitud }}</p>
                {% if comercio.barrio %}
                <p><strong>Barrio:</strong> {{ comercio.barrio.nombre }}</p>
                {% endif %}
            </div>
        </div>
        
        {% if comercio.propietarios %}
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">Propietarios</h5>
            </div>
            <div class="card-body">
                {% for propietario in comercio.propietarios %}
                <p>
                    <strong>{{ propietario.persona.nombre_completo if propietario.persona else 'N/A' }}</strong><br>
                    DNI: {{ propietario.persona.dni if propietario.persona else 'N/A' }}<br>
                    Porcentaje: {{ propietario.porcentaje }}%
                </p>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<div class="mt-3">
    <a href="{{ url_for('control_comercial.index') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Volver a la lista
    </a>
</div>
{% endblock %}

